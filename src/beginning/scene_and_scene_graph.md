# Сцена и граф сцены

Когда вы играете в игру, вы часто видите различные объекты, разбросанные по экрану, которые вместе формируют _сцену_. Сцена — это просто набор разнообразных объектов. Как и во многих других игровых движках, Fyrox позволяет создавать несколько сцен для различных целей. Например, одна сцена может использоваться для меню, несколько других — для уровней игры, а ещё одна — для финального экрана. Сцены также могут использоваться как источник данных для других сцен — такие сцены называются _префабами_. Сцены также могут быть отрендерены в текстуру, которая может использоваться в других сценах — таким образом можно создавать интерактивные экраны, показывающие другие места.

Во время игры вы могли заметить, что некоторые объекты ведут себя так, как будто они связаны с другими объектами. Например, персонаж в ролевой игре может держать меч. Пока персонаж держит меч, он привязан к его руке. Такие отношения между объектами могут быть представлены в виде графа.

Проще говоря, граф — это набор объектов с иерархическими отношениями между каждым объектом. Каждый объект в графе называется _узлом_. В примере с мечом и персонажем меч является _дочерним_ узлом персонажа, а персонаж — _родительским_ узлом меча (здесь мы игнорируем тот факт, что в реальности модели персонажей обычно содержат сложные скелеты, и меч привязывается к одной из костей руки, а не к персонажу напрямую).

Вы можете изменять иерархию узлов в редакторе с помощью простой функции перетаскивания в `World Viewer` — перетащите узел на другой узел, и он привяжется к нему.

## Базовые элементы или узлы сцены

Движок предлагает различные типы "строительных блоков" для вашей сцены, каждый такой блок называется _узлом сцены_.

- [Базовый узел (Base)](../scene/base_node.md) — хранит иерархическую информацию (ссылку на родительский узел и ссылки на дочерние узлы), локальное и глобальное преобразование, имя, тег, время жизни и т.д. Его название говорит само за себя — он используется как базовый узел для всех остальных узлов сцены через композицию.
- [Модель (Mesh)](../scene/mesh_node.md) — представляет 3D-модель. Это один из наиболее часто используемых узлов в почти каждой игре. Модели могут быть легко созданы как программно, так и в 3D-редакторах, таких как Blender, а затем загружены в сцену.
- [Источник света (Light)](../scene/light_node.md) — представляет источник света. Существует три типа источников света:
    - **Точечный (Point)** — излучает свет во всех направлениях. Пример из реального мира — лампочка.
    - **Прожекторный (Spot)** — излучает свет в определённом направлении, образуя конус света. Пример из реального мира — фонарик.
    - **Направленный (Directional)** — излучает свет в определённом направлении, но не имеет позиции. Ближайший пример из реального мира — Солнце.
- [Камера (Camera)](../scene/camera_node.md) — позволяет вам видеть мир. В вашей сцене должна быть хотя бы одна камера, чтобы вы могли что-то увидеть.
- [Спрайт (Sprite)](../scene/sprite_node.md) — представляет собой прямоугольник, который всегда повёрнут к камере. Он может иметь текстуру и размер, а также может быть повёрнут вокруг оси "взгляда".
- [Система частиц (Particle system)](../scene/particle_system_node.md) — позволяет создавать визуальные эффекты с помощью большого количества мелких частиц. Она может использоваться для создания дыма, искр, брызг крови и т.д.
- [Ландшафт (Terrain)](../scene/terrain_node.md) — позволяет создавать сложные ландшафты с минимальными усилиями.
- [Декаль (Decal)](../scene/decal_node.md) — накладывает текстуру на другие узлы. Используется для имитации трещин в бетонных стенах, повреждений на дороге, брызг крови, следов от пуль и т.д.
- [Твёрдое тело (Rigid Body)](../physics/rigid_body.md) — физический объект, отвечающий за динамику твёрдого тела. Существует специальная версия для 2D — `RigidBody2D`.
- [Коллайдер (Collider)](../physics/collider.md) — физическая форма для твёрдого тела. Он отвечает за генерацию контактных поверхностей. Без коллайдера твёрдое тело не будет корректно участвовать в симуляции, поэтому каждое твёрдое тело должно иметь хотя бы один коллайдер. Существует специальная версия для 2D — `Collider2D`.
- [Соединение (Joint)](../physics/joint.md) — физический объект, который ограничивает движение между двумя твёрдыми телами. Он имеет различное количество степеней свободы в зависимости от типа соединения. Существует специальная версия для 2D — `Joint2D`.
- [Прямоугольник (Rectangle)](../scene/rectangle.md) — простая прямоугольная модель, которая может иметь текстуру и цвет. Это очень упрощённая версия узла модели, но она использует оптимизированный рендерер, позволяющий отображать десятки прямоугольников одновременно. Этот узел предназначен только для использования в **2D-играх**.
- [Звук (Sound)](../sound/sound.md) — источник звука, универсальный для 2D и 3D. Фактор пространственного смешивания позволяет выбрать пропорцию между 2D и 3D.
- Слушатель (Listener) — приёмник звука, который захватывает звук в определённой точке сцены и отправляет его в аудиоконтекст для обработки и вывода на устройство воспроизведения звука.
- Проигрыватель анимаций (Animation Player) — контейнер для нескольких анимаций. Он может воспроизводить анимации, созданные в [редакторе анимаций](../animation/anim_editor.md), и применять позы анимации к соответствующим узлам сцены.
- Машина состояний смешивания анимаций (Animation Blending State Machine) — машина состояний, которая смешивает несколько анимаций из нескольких состояний в одну; каждое состояние поддерживается одним или несколькими узлами воспроизведения или смешивания анимаций. Подробнее см. в [соответствующей главе](../animation/absm_editor.md).

Каждый узел может быть создан либо в редакторе (через `Create` в главном меню или через `Add Child` после правого клика на игровом объекте), либо программно с помощью соответствующего конструктора узлов (подробнее см. в [документации API](https://docs.rs/fyrox/latest/fyrox/scene/index.html)). Эти узлы сцены позволяют создавать практически любые виды игр. Также возможно создавать собственные типы узлов, но это продвинутая тема, которая рассматривается в [будущей главе](../scene/custom_node.md).

## Локальные и глобальные координаты

Граф описывает вашу сцену очень естественным образом, позволяя вам думать в терминах относительных и абсолютных координат при работе с _узлами сцены_.

Узел сцены имеет два вида преобразований — локальное и глобальное. Локальное преобразование определяет, где находится узел относительно его начала, его масштаб в процентах и его поворот вокруг произвольной оси. Глобальное преобразование почти такое же, но оно также включает всю цепочку преобразований родительских узлов. Возвращаясь к примеру с персонажем и мечом, если персонаж двигается, и, следовательно, меч тоже, глобальное преобразование меча будет отражать изменения в позиции персонажа, но его локальное преобразование не изменится, так как оно представляет позицию меча относительно персонажа, которая осталась прежней.

Этот механизм очень прост, но мощный. Его полная красота раскрывается, когда вы работаете с 3D-моделями, содержащими скелеты. Каждая кость в скелете имеет своего родителя и набор дочерних костей, что позволяет вам вращать, перемещать или масштабировать их для анимации всего персонажа.