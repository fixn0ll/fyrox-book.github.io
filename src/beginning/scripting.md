# Редактор, плагины и скрипты

Каждая игра на Fyrox — это просто плагин как для движка, так и для редактора. Такой подход позволяет запускать игру прямо из редактора и редактировать её сущности. Игра может определять любое количество скриптов, которые можно назначать объектам сцены для выполнения пользовательской игровой логики. В этой главе мы рассмотрим, как установить движок с его специфичными для платформы зависимостями, как использовать плагины и систему скриптов, а также как запустить редактор.

## Специфичные для платформы зависимости

Прежде чем начать использовать движок, убедитесь, что все необходимые специфичные для платформы зависимости для разработки установлены. Если вы используете Windows или macOS, никаких дополнительных зависимостей, кроме [последней версии Rust](https://rustup.rs) с подходящим набором инструментов для вашей платформы, не требуется.

### Linux

На Linux для разработки с Fyrox необходимы следующие библиотеки: `libxcb-shape0`, `libxcb-xfixes0`, `libxcb1`, `libxkbcommon`, `libasound2`, `libegl-mesa0` и группа пакетов `build-essential`.

Для дистрибутивов на основе Debian, таких как Ubuntu, их можно установить следующим образом:

```shell
sudo apt install libxcb-shape0-dev libxcb-xfixes0-dev libxcb1-dev libxkbcommon-dev libasound2-dev libegl-mesa0 build-essential
```

Для NixOS можно использовать файл `shell.nix` следующего содержания:

```nix
{ pkgs ? import <nixpkgs> { } }:
pkgs.mkShell rec {
  nativeBuildInputs = with pkgs.buildPackages; [
    pkg-config
    xorg.libxcb
    alsa-lib
    wayland
    libxkbcommon
    libGL
  ];

  shellHook = with pkgs.lib; ''
    export LD_LIBRARY_PATH=${makeLibraryPath nativeBuildInputs}:/run/opengl-driver/lib:$LD_LIBRARY_PATH
  '';
}
```

## Менеджер проектов

![менеджер проектов](https://fyrox.rs/assets/0.36/project_manager.png)

Менеджер проектов — это часть движка, которая позволяет управлять несколькими проектами, созданными с его помощью. Он позволяет создавать новые проекты или импортировать существующие, запускать их или редактировать в редакторе, обновлять проект до выбранной версии движка и многое другое.

[Скачайте менеджер проектов](https://fyrox.rs/download.html) для вашей операционной системы и запустите его. Затем нажмите кнопку `+Create`, выберите путь, где должен располагаться проект, и нажмите `Create`. Выберите новый проект в списке и нажмите кнопку `Edit`, чтобы запустить редактор.

## Быстрый старт с использованием консольных команд

Выполните следующие команды, чтобы начать использовать редактор как можно быстрее.

```sh
cargo install fyrox-template
fyrox-template init --name fyrox_test --style 2d
cd fyrox_test
cargo run --package editor --release
```

## Генератор проектов

> ⚠️ Этот раздел в основном для пользователей консоли и тех, кто предпочитает собирать своё программное обеспечение из исходного кода.
> По возможности используйте Менеджер проектов, он делает то же самое, что и `fyrox-template`, но с графическим интерфейсом.

Плагины Fyrox написаны на Rust, это означает, что при изменении исходного кода игры необходимо перекомпилировать проект. Такая архитектура требует некоторого шаблонного кода. Fyrox предлагает специальный инструмент командной строки — `fyrox-template`. Он помогает сгенерировать весь этот шаблонный код одной командой. Установите его, выполнив следующую команду:

```shell
cargo install fyrox-template
```

_Примечание для Linux:_ Утилита устанавливается в `$user/.cargo/bin`. Если вы получаете ошибки о том, что команда `fyrox-template` не найдена, добавьте эту скрытую папку `cargo bin` в переменную окружения `$PATH` вашей операционной системы.

Теперь перейдите в папку, где должен быть создан проект, и выполните следующую команду:

```shell
fyrox-template init --name my_game --style 3d
```

Обратите внимание, что в отличие от `cargo init`, эта команда создаст новую папку с указанным именем.

Инструмент принимает два аргумента — имя проекта (`--name`) и стиль (`--style`), который определяет содержимое сцены по умолчанию. После инициализации проекта перейдите в `game/src/lib.rs` — здесь находится логика игры. Как видите, `fyrox-template` сгенерировал для вас довольно много кода. В файле есть комментарии, объясняющие назначение каждого участка кода. Для получения дополнительной информации о каждом методе обратитесь к [документации](https://docs.rs/fyrox/latest/fyrox/plugin/trait.Plugin.html).

После создания проекта можно использовать две команды для запуска игры в разных режимах:

- `cargo run --package editor --release` — запускает редактор с вашей игрой. Редактор позволяет запускать игру и редактировать её сущности. Он предназначен только для разработки.
- `cargo run --package executor --release` — создаёт и запускает готовый бинарный файл вашей игры, который можно распространять (например, в магазине приложений).

Перейдите в папку вашего проекта и выполните `cargo run --package editor --release`. Через некоторое время вы увидите редактор:

![редактор](editor.png)

В редакторе вы можете начать создавать свою игровую сцену. **Важное замечание:** ваша сцена должна содержать хотя бы одну камеру, иначе вы ничего не увидите. Прочитайте следующую главу, чтобы узнать, как использовать редактор.

## Использование последней версии движка

Из-за природы разработки программного обеспечения, некоторые ошибки неизбежно попадают в основные релизы. Поэтому рекомендуется использовать последнюю версию движка из репозитория на GitHub, так как она с наибольшей вероятностью содержит исправления ошибок (вы также можете внести свой вклад, исправив найденные ошибки или хотя бы [сообщив о них](https://github.com/FyroxEngine/Fyrox/issues)).

### Автоматическое обновление

> ⚠️ У `fyrox-template` есть специальная подкоманда — `upgrade`, которая позволяет быстро обновиться до нужной версии движка. Чтобы обновиться до последней версии (`nightly`), выполните команду `fyrox-template upgrade --version nightly` в папке вашего проекта.

Основные варианты для ключа `--version`:

- `nightly` — использует последнюю nightly-версию движка напрямую из GitHub. Это предпочтительный вариант, если вы хотите использовать последние изменения и исправления ошибок сразу после их выпуска.
- `latest` — использует последнюю стабильную версию движка. Этот вариант также поддерживает ключ `--local`, который указывает путь к движку как `../Fyrox/fyrox`, а к редактору — `../Fyrox/editor`. Очевидно, такой путь требует, чтобы движок находился в родительской папке вашего проекта. Этот вариант может быть полезен, если вы хотите использовать кастомную версию движка (например, если вы разрабатываете патч для движка).
- `major.minor.patch` — использует конкретную стабильную версию из crates.io (например, `0.30.0`).

### Ручное обновление

Версию движка также можно обновить вручную. Первый шаг — установить последнюю версию `fyrox-template`, это можно сделать одной командой:

```shell
cargo install fyrox-template --force --git https://github.com/FyroxEngine/Fyrox
```

Это гарантирует, что вы используете последнюю версию генератора шаблонов проектов и скриптов, что важно, так как старые версии генератора могут создавать устаревший код, который больше не совместим с движком.

Чтобы перевести существующие проекты на последнюю версию движка, необходимо указать пути к удалённому репозиторию для зависимостей `fyrox` и `fyroxed_base`. Всё, что нужно сделать, — изменить пути к этим зависимостям в корневом `Cargo.toml`:

```toml
[workspace.dependencies.fyrox]
version = { git = "https://github.com/FyroxEngine/Fyrox" }
default-features = false
[workspace.dependencies.fyroxed_base]
version = { git = "https://github.com/FyroxEngine/Fyrox" }
```

Теперь ваша игра будет использовать последнюю версию движка и редактора, но будьте осторожны — новые коммиты могут содержать изменения в API. Вы можете избежать этого, указав конкретный коммит, добавив `rev = "хэш_коммита"` к каждой зависимости, например:

```toml
[dependencies]
[workspace.dependencies.fyrox]
version = { git = "https://github.com/FyroxEngine/Fyrox", rev = "0195666b30562c1961a9808be38b5e5715da43af" }
default-features = false
[workspace.dependencies.fyroxed_base]
version = { git = "https://github.com/FyroxEngine/Fyrox", rev = "0195666b30562c1961a9808be38b5e5715da43af" }
```

Чтобы обновить локальный git-репозиторий движка до последней версии, выполните команду `cargo update` в корневой папке проекта. Это загрузит последние изменения из удалённого репозитория, если не указан конкретный коммит.

Подробнее о путях зависимостей можно узнать в официальной документации `cargo`, [здесь](https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#specifying-dependencies-from-git-repositories).

## Добавление игровой логики

Любая объектно-ориентированная игровая логика должна добавляться с помощью скриптов. Скрипт — это "контейнер" для данных и кода, который будет выполняться движком. Прочитайте главу [Скрипты](../scripting/script.md), чтобы узнать, как создавать, редактировать и использовать скрипты в вашей игре.