# Узел света (Light Node)

Движок предлагает сложную систему освещения с различными типами источников света.

## Типы источников света

Есть три основных типа источников света: направленный, точечный и прожектор.

### Направленный свет (Directional Light)

Направленный свет не имеет позиции, его лучи всегда параллельны, и он имеет определённое направление в пространстве. Пример направленного света в реальной жизни — это наше Солнце. Даже если это точечный источник света, он находится так далеко от Земли, что мы можем считать его лучи всегда параллельными. Направленные источники света подходят для сцен на открытом воздухе.

Направленный источник света можно создать следующим образом:

```rust,no_run
{{#include ../code/snippets/src/scene/light.rs:create_directional_light}}
```

По умолчанию источник света будет ориентирован так, чтобы освещать "землю". Другими словами, его направление будет направлено в сторону вектора `(0.0, -1.0, 0.0)`. Вы можете повернуть его, как хотите, установив локальную трансформацию при создании. Например, так:

```rust,no_run
{{#include ../code/snippets/src/scene/light.rs:create_oriented_directional_light}}
```

### Точечный свет (Point Light)

Точечный свет — это источник света, который излучает свет во всех направлениях, он имеет позицию, но не имеет ориентации. Пример точечного источника света: лампочка.

```rust,no_run
{{#include ../code/snippets/src/scene/light.rs:create_point_light}}
```

### Прожектор (Spotlight)

Прожектор — это источник света, который излучает свет в форме конуса, он имеет позицию и ориентацию. Пример прожектора: фонарик.

```rust,no_run
{{#include ../code/snippets/src/scene/light.rs:create_spot_light}}
```

## Рассеивание света

![Рассеивание](scattering.png)

Прожекторы и точечные источники света поддерживают эффект рассеивания света. Представьте, что вы идёте с фонариком в туманную погоду, туман будет рассеивать свет от вашего фонарика, создавая "объём света". Рассеивание света **включено по умолчанию**, поэтому вам не нужно ничего делать, чтобы включить его. Однако в некоторых случаях вы можете захотеть отключить его, это можно сделать как при создании источника света, так и изменив параметры рассеивания на существующем источнике света. Вот небольшой пример, как это сделать.

```rust,no_run
{{#include ../code/snippets/src/scene/light.rs:disable_light_scatter}}
```

Вы также можете изменить количество рассеивания для каждого цветового канала, используя это, вы можете имитировать [Рэлеевское рассеяние](https://ru.wikipedia.org/wiki/Рэлеевское_рассеяние):

```rust,no_run
{{#include ../code/snippets/src/scene/light.rs:use_rayleigh_scattering}}
```

## Тени

По умолчанию источники света отбрасывают тени. Вы можете изменить это, используя метод `set_cast_shadows` источника света. Вам следует тщательно управлять тенями: тени оказывают наибольшее влияние на производительность, вы должны держать количество источников света, которые могут отбрасывать тени, на минимально возможном уровне, чтобы поддерживать производительность на хорошем уровне. Вы также можете включать/выключать тени, когда это необходимо:

```rust,no_run
{{#include ../code/snippets/src/scene/light.rs:switch_shadows}}
```

Не каждый источник света должен отбрасывать тени, например, маленький источник света, который игрок может видеть только на расстоянии, может иметь тени отключёнными. Вы должны устанавливать соответствующие значения в зависимости от вашей сцены, просто помните: чем меньше теней, тем выше производительность. Самые дорогие тени — от точечных источников света, менее дорогие — от прожекторов и направленных источников света.

## Производительность

Источники света не дешёвые, каждый источник света оказывает некоторое влияние на производительность. Как общее правило, старайтесь держать количество источников света на разумном уровне и особенно старайтесь избегать создания множества источников света на небольшой площади. Помните, что чем меньше площадь, которую нужно "осветить", тем выше производительность. Это означает, что вы можете иметь множество маленьких источников света практически бесплатно.