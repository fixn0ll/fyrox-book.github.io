# Сцена (Scene)

Сцена — это контейнер для игровых сущностей. В настоящее время сцены в движке управляют следующими сущностями:

1) Граф сцены
2) Анимации
3) Физика (твёрдые тела, коллайдеры, соединения)
4) Звук

Сцена позволяет вам создавать изолированные "миры", которые не будут взаимодействовать с другими сценами, что очень полезно для многих более или менее сложных игр.

## Как создать сцену

Сцену можно создать либо в FyroxEd, либо программно. Вы также можете комбинировать оба подхода, где вы создаёте весь "статический" контент в редакторе, а остальные сущности (боты, интерактивные объекты и т.д.) добавляете вручную, инстанцируя соответствующие префабы во время выполнения.

### Использование FyroxEd

В книге есть [отдельная глава](../beginning/editor_overview.md), которая поможет вам создать сцену. После создания сцены вы можете загрузить её с помощью асинхронного загрузчика сцен:

```rust,no_run
{{#include ../code/snippets/src/scene/mod.rs:load_scene}}
```

Код довольно прост. Сначала мы используем асинхронный загрузчик сцен для создания запроса на загрузку сцены. Этот запрос будет обработан в отдельном потоке, оставляя вашу игру полностью отзывчивой во время загрузки сцены. Затем, когда сцена полностью загружена и добавлена в движок, вызывается метод `on_scene_loaded`. Обычно активна только одна сцена, поэтому мы удаляем предыдущую и устанавливаем новую как активную.

Есть два дополнительных метода:

1) `on_scene_begin_loading` — вызывается, когда сцена только начинает загружаться. Имейте в виду, что асинхронный загрузчик сцен может загружать несколько сцен одновременно, и этот метод гарантированно вызывается непосредственно перед началом загрузки сцены.
2) `on_scene_loading_failed` — вызывается, если сцена не смогла загрузиться. Этот метод может быть полезен, если вы используете непроверенные сцены (например, из модов игры) и хотите как-то отреагировать на неудачную загрузку сцены.

### Создание сцены вручную

Сцену также можно создать вручную:

```rust,no_run
{{#include ../code/snippets/src/scene/mod.rs:create_scene}}
```

См. соответствующую [документацию](../scene/graph.md#using-node-builders) про конструктор узлов, чтобы заполнить сцену.

## Где находятся все мои сцены?

Все сцены "живут" в движке, движок владеет вашей сценой после того, как вы добавили её в движок. Вы можете заимствовать сцену в любое время, используя её дескриптор, и внести некоторые изменения:

```rust,no_run
{{#include ../code/snippets/src/scene/mod.rs:scene_borrowing}}
```

## Асинхронное создание сцены

Вы можете создать свою сцену в отдельном потоке, а затем передать её в основной поток, чтобы вставить её в движок. Зачем это нужно? Вспомните последний раз, когда вы играли в относительно большую игру, вы, вероятно, заметили, что в ней есть экраны загрузки, и на экране загрузки есть какой-то интерактивный элемент с индикатором прогресса. Экран загрузки полностью отзывчив, пока игра выполняет тяжёлую работу по загрузке мира для вас. Уловили? Асинхронная загрузка сцены необходима для создания/загрузки больших сцен с тоннами ресурсов без блокировки основного потока, оставляя игру полностью отзывчивой.

## Управление несколькими сценами

Обычно у вас должна быть активна только одна сцена (если вы не делаете что-то очень особенное), вы должны использовать флаг `.enabled` сцены, чтобы включать или выключать её. Деактивированные сцены не будут рендериться, физика не будет обновляться, звук остановится и так далее. Другими словами, сцена будет заморожена. Это полезно для ситуаций, когда вам часто нужно переключаться между сценами, оставляя другие сцены в замороженном состоянии. Один из примеров, где это может быть полезно, — это меню. В большинстве игр, когда вы входите в меню, игровой мир приостанавливается.

## Окружающее освещение

Каждая сцена имеет освещение по умолчанию, оно определяется одним цветом RGB. По умолчанию каждая сцена имеет предопределённое окружающее освещение, оно достаточно яркое, чтобы вы могли видеть свои объекты. В некоторых случаях вам может потребоваться настроить его или даже сделать чёрным (например, для хоррор-игр), это можно сделать одной строкой кода:

```rust,no_run
{{#include ../code/snippets/src/scene/mod.rs:set_ambient_lighting}}
```

Пожалуйста, имейте в виду, что окружающее освещение не означает глобальное освещение, это другая техника освещения, которая пока недоступна в движке.